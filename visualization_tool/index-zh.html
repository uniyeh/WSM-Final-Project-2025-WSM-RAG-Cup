<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RAG Evaluation Visualizer(zh)</title>
    <style>
        :root {
            --bg-color: #0f172a;
            --text-color: #e2e8f0;
            --primary-color: #3b82f6;
            --secondary-color: #1e293b;
            --accent-color: #60a5fa;
            --success-color: #22c55e;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            --border-color: #334155;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 0;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        header {
            margin-bottom: 2rem;
            text-align: center;
        }

        h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            background: linear-gradient(to right, var(--primary-color), var(--accent-color));
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .upload-section {
            background-color: var(--secondary-color);
            border: 2px dashed var(--border-color);
            border-radius: 1rem;
            padding: 2rem;
            text-align: center;
            margin-bottom: 2rem;
            transition: border-color 0.3s ease;
        }

        .upload-section:hover {
            border-color: var(--primary-color);
        }

        input[type="file"] {
            display: none;
        }

        .custom-file-upload {
            display: inline-block;
            padding: 0.75rem 1.5rem;
            cursor: pointer;
            background-color: var(--primary-color);
            color: white;
            border-radius: 0.5rem;
            font-weight: 600;
            transition: background-color 0.3s ease;
        }

        .custom-file-upload:hover {
            background-color: var(--accent-color);
        }

        .metrics-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .metric-card {
            background-color: var(--secondary-color);
            padding: 1.5rem;
            border-radius: 0.75rem;
            text-align: center;
            border: 1px solid var(--border-color);
        }

        .metric-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--accent-color);
        }

        .baseline-value {
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--primary-color);
            opacity: 0;
        }

        .metric-label {
            font-size: 0.875rem;
            color: #94a3b8;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background-color: var(--secondary-color);
            border-radius: 0.75rem;
            overflow: hidden;
        }

        th,
        td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        th {
            background-color: #1e293b;
            font-weight: 600;
            color: #94a3b8;
            cursor: pointer;
            user-select: none;
        }

        th:hover {
            color: var(--text-color);
        }

        tr:hover {
            background-color: #2d3748;
        }

        .score-cell {
            font-family: 'Roboto Mono', monospace;
            font-weight: 600;
        }

        .expand-btn {
            background: none;
            border: none;
            color: var(--accent-color);
            cursor: pointer;
            font-size: 1.2rem;
        }

        .details-row {
            display: none;
            background-color: #1a202c;
        }

        .details-content {
            padding: 1.5rem;
        }

        .detail-section {
            margin-bottom: 1.5rem;
        }

        .detail-title {
            font-weight: 600;
            color: #94a3b8;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
        }

        .detail-text {
            background-color: #2d3748;
            padding: 1rem;
            border-radius: 0.5rem;
            white-space: pre-wrap;
            font-family: 'Roboto Mono', monospace;
            font-size: 0.9rem;
        }

        .references-list {
            list-style-type: disc;
            padding-left: 1.5rem;
        }

        .references-list li {
            margin-bottom: 0.5rem;
        }

        .score-high {
            color: var(--success-color);
        }

        .score-med {
            color: var(--warning-color);
        }

        .score-low {
            color: var(--danger-color);
        }

        .diff-positive {
            color: var(--success-color);
            font-size: 0.8em;
            margin-left: 4px;
        }

        .diff-negative {
            color: var(--danger-color);
            font-size: 0.8em;
            margin-left: 4px;
        }

        .diff-neutral {
            color: #94a3b8;
            font-size: 0.8em;
            margin-left: 4px;
        }
    </style>
</head>

<body>
    <div class="container">
        <header>
            <h1>RAG Evaluation Visualizer(zh, 1204)</h1>
            <p>Upload your <code>.jsonl</code> score file to visualize the results.</p>
        </header>

        <div class="upload-section">
            <label for="file-upload" class="custom-file-upload">
                Choose File
            </label>
            <input id="file-upload" type="file" accept=".jsonl" />
            <p id="file-name" style="margin-top: 1rem; color: #94a3b8;"></p>
        </div>

        <div id="dashboard" style="display: none;">
            <div class="metrics-summary">
                <div class="metric-card">
                    <div class="metric-value" id="avg-sentences-precision">0.00</div>
                    <div class="baseline-value" id="avg-sentences-precision-bs">=</div>
                    <div class="metric-label">Avg Sentences Precision</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="avg-sentences-recall">0.00</div>
                    <div class="baseline-value" id="avg-sentences-recall-bs">=</div>
                    <div class="metric-label">Avg Sentences Recall</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="avg-sentences-f1">0.00</div>
                    <div class="baseline-value" id="avg-sentences-f1-bs">=</div>
                    <div class="metric-label">Avg Sentences F1</div>
                </div>
            </div>
            <div class="metrics-summary">
                <div class="metric-card">
                    <div class="metric-value" id="avg-words-precision">0.00</div>
                    <div class="baseline-value" id="avg-words-precision-bs">=</div>
                    <div class="metric-label">Avg Words Precision</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="avg-words-recall">0.00</div>
                    <div class="baseline-value" id="avg-words-recall-bs">=</div>
                    <div class="metric-label">Avg Words Recall</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="avg-words-f1">0.00</div>
                    <div class="baseline-value" id="avg-words-f1-bs">=</div>
                    <div class="metric-label">Avg Words F1</div>
                </div>
            </div>
            <div class="metrics-summary">
                <div class="metric-card">
                    <div class="metric-value" id="avg-rouge">0.00</div>
                    <div class="baseline-value" id="avg-rouge-bs">=</div>
                    <div class="metric-label">Avg ROUGE-L</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="avg-completeness">0.00</div>
                    <div class="baseline-value" id="avg-completeness-bs">=</div>
                    <div class="metric-label">Avg Completeness</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="avg-hallucination">0.00</div>
                    <div class="baseline-value" id="avg-hallucination-bs">=</div>
                    <div class="metric-label">Avg Hallucination</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="avg-irrelevance">0.00</div>
                    <div class="baseline-value" id="avg-irrelevance-bs">=</div>
                    <div class="metric-label">Avg Irrelevance</div>
                </div>
            </div>

            <table id="results-table">
                <thead>
                    <tr>
                        <th width="50"></th>
                        <th onclick="sortTable('query_id')">ID ↕</th>
                        <th>Query</th>
                        <th onclick="sortTable('Sentences_Precision')">Sent Prec ↕</th>
                        <th onclick="sortTable('Sentences_Recall')">Sent Rec ↕</th>
                        <th onclick="sortTable('Sentences_F1')">Sent F1 ↕</th>
                        <th onclick="sortTable('Words_Precision')">Words Prec ↕</th>
                        <th onclick="sortTable('Words_Recall')">Words Rec ↕</th>
                        <th onclick="sortTable('Words_F1')">Words F1 ↕</th>
                        <th onclick="sortTable('ROUGELScore')">ROUGE-L ↕</th>
                        <th onclick="sortTable('completeness')">Comp ↕</th>
                        <th onclick="sortTable('hallucination')">Hallu ↕</th>
                        <th onclick="sortTable('irrelevance')">Irrel ↕</th>
                    </tr>
                </thead>
                <tbody id="table-body">
                    <!-- Rows will be populated here -->
                </tbody>
            </table>
        </div>
    </div>

    <script id="initial-data" type="text/plain">
       {"domain": "Finance", "language": "zh", "query": {"query_id": 0, "query_type": "无关无解问", "content": "绿源环保有限公司在2017年12月设立了什么子公司？"}, "ground_truth": {"doc_ids": [5], "content": "无法回答", "references": [], "keypoints": ["无法回答"]}, "prediction": {"content": "绿源环保有限公司在2017年12月设立了一个子公司。具体信息未提供。", "references": ["绿源环保有限公司是一家成立于2005年6月的环保企业，主要从事绿色能源的研发、生产和销售业务，注册地位于北京市，目前尚未上市。", "2017年是绿源环保有限公司发展的关键一年。在财务信息方面，公司完成了一系列重要的资产重组和投资活动，为公司的未来发展奠定了坚实基础。", "为了提升可持续性和社会责任，绿源环保有限公司于2017年2月推出了一系列倡议。这些倡议旨在推动公司在可持续发展和社会责任方面的表现，并与相关利益相关者合作，共同推动环保事业的发展。", "在2017年7月，绿源环保有限公司进行了董事会变更。这一变更有助于提升公司的治理效能，并确保公司的决策能够更好地符合利益相关者的期望。", "在环境责任方面，绿源环保有限公司在2017年度采取了一系列重要的举措。首先，公司投资于碳抵消项目，通过投资林业项目或可再生能源项目来抵消其碳排放，努力实现碳中和目标。这一举措是在2017年2月实施的，通过碳抵消证书，公司能够向利益相关者展示其对环境的承诺和责任。此外，公司还制定了环境和社会责任政策，明确了在环境保护和社会责任方面的目标和承诺。在2017年1月至2月，公司对多个可再生能源项目进行了评估，包括太阳能、风能等，评估结果为公司选择投资碳抵消项目提供了依据，并为未来项目投资决策提供了参考。最终，公司在2017年2月投资了碳抵消项目，通过投资林业项目或可再生能源项目来抵消其碳排放，进一步展示了公司对环境的承诺和责任。"]}, "ROUGELScore": 0.0, "Words_Precision": 0.0, "Words_Recall": 0.0, "Sentences_Precision": 0.0, "Sentences_Recall": 0.0, "completeness": 0.0, "hallucination": 0.0, "irrelevance": 1.0, "responses": {"complete_ids": [], "irrelevant_ids": [1], "hallucinate_ids": []}}
{"domain": "Finance", "language": "zh", "query": {"query_id": 8, "query_type": "多跳推理问题", "content": "根据绿源环保有限公司2017年度环境与社会责任报告，绿源环保有限公司是如何通过投资碳抵消项目、实施节能减排项目和开发绿色产品来支持其未来环境保护计划的？"}, "ground_truth": {"doc_ids": [5], "content": "绿源环保有限公司在2017年通过一系列措施支持其未来环境保护计划。首先，公司在2017年2月投资于碳抵消项目，通过林业项目和可再生能源项目来抵消其碳排放，努力实现碳中和目标。其次，公司在2017年6月实施了节能减排项目，减少了能源消耗和温室气体排放，直接提高了能效和环境绩效。最后，公司在2017年8月开发了环保型产品，减少了对环境的影响，提升了产品的市场竞争力和品牌形象。这些措施为公司未来的环境保护计划提供了坚实的基础。", "references": ["首先，公司投资于碳抵消项目，通过投资林业项目或可再生能源项目来抵消其碳排放，努力实现碳中和目标。", "最终，公司在2017年2月投资了碳抵消项目，通过投资林业项目或可再生能源项目来抵消其碳排放，进一步展示了公司对环境的承诺和责任。", "此外，公司在2017年6月投资实施了节能减排项目，旨在减少能源消耗和温室气体排放。", "这一举措直接减少了公司的能源消耗和碳足迹，提高了能效和环境绩效。", "在2017年8月，公司还开发了环保型产品，减少对环境的影响，提升了产品的市场竞争力和品牌形象，同时减少了环境影响。"], "keypoints": ["1. 公司在2017年2月投资于碳抵消项目，通过林业项目和可再生能源项目来抵消其碳排放，努力实现碳中和目标。", "2. 公司在2017年6月实施了节能减排项目，减少了能源消耗和温室气体排放，直接提高了能效和环境绩效。", "3. 公司在2017年8月开发了环保型产品，减少了对环境的影响，提升了产品的市场竞争力和品牌形象。"]}, "prediction": {"content": "绿源环保有限公司通过投资碳抵消项目、建立污染防治设施、实施节能减排项目和开发绿色产品来支持其未来的环境保护计划。此外，公司还推出了倡议以提升可持续性和社会责任，并参与慈善活动、社区发展项目等。", "references": ["在环境责任方面，绿源环保有限公司在2017年度采取了一系列重要的举措。首先，公司投资于碳抵消项目，通过投资林业项目或可再生能源项目来抵消其碳排放，努力实现碳中和目标。这一举措是在2017年2月实施的，通过碳抵消证书，公司能够向利益相关者展示其对环境的承诺和责任。此外，公司还制定了环境和社会责任政策，明确了在环境保护和社会责任方面的目标和承诺。在2017年1月至2月，公司对多个可再生能源项目进行了评估，包括太阳能、风能等，评估结果为公司选择投资碳抵消项目提供了依据，并为未来项目投资决策提供了参考。最终，公司在2017年2月投资了碳抵消项目，通过投资林业项目或可再生能源项目来抵消其碳排放，进一步展示了公司对环境的承诺和责任。", "为了提升可持续性和社会责任，绿源环保有限公司于2017年2月推出了一系列倡议。这些倡议旨在推动公司在可持续发展和社会责任方面的表现，并与相关利益相关者合作，共同推动环保事业的发展。", "综上所述，绿源环保有限公司在2017年度在环境责任和社会责任方面采取了一系列重要举措。公司通过投资碳抵消项目、建立污染防治设施、实施环境管理系统、投资节能减排项目和开发绿色产品等方式，积极履行环境责任。同时，公司参与慈善活动、支持社区发展、参与公共服务项目、关注员工健康与安全和职业成长等方面，积极履行社会责任。公司的各项举措和指标数据表明，绿源环保有限公司在环境和社会责任方面取得了显著的进展，并为未来的可持续发展奠定了基础。", "另外，绿源环保有限公司在环境责任方面还采取了其他重要举措。公司在2017年3月建立了新的污染防治设施，如废水处理系统和排放控制设备，以减少环境污染。这一举措显著降低了公司的环境污染水平，增强了合规性和社会责任感。在2017年5月，公司实施了环境管理系统（EMS），以提高环境绩效，减少废物产生，并确保合规。这一举措增强了公司的环境管理能力和持续改进，提升了合规性和市场认可度。此外，公司在2017年6月投资实施了节能减排项目，旨在减少能源消耗和温室气体排放。这一举措直接减少了公司的能源消耗和碳足迹，提高了能效和环境绩效。在2017年8月，公司还开发了环保型产品，减少对环境的影响，提升了产品的市场竞争力和品牌形象，同时减少了环境影响。", "在社会责任方面，绿源环保有限公司也采取了一系列重要举措。公司在2017年3月参与或资助了慈善活动和慈善机构，以支持教育、健康、减贫等领域。这一举措提高了公司的社会形象和品牌认知，加强了与社区的联系和支持。然而，在2017年4月，公司由于人为管理失误，发生了一起严重的废水泄漏事故，对周边环境和社区造成了污染。公司面临环境修复及赔偿责任，同时也受到了负面舆论的影响，公司形象受损。为了弥补这一失误，公司在2017年6月投资于当地社区，支持教育、健康和社会发展项目，加深了公司与社区的联系，促进了社区的整体福祉和发展。此外，公司还在2017年8月投资或参与公共服务项目，如城市绿化、公共卫生改善项目，以提升社区生活质量。这些举措促进了社区的可持续发展，增强了公众对公司的积极感知。"]}, "ROUGELScore": 0.24277456217982565, "Words_Precision": 0.2895927601809955, "Words_Recall": 1.0, "Sentences_Precision": 0.18935837245696402, "Sentences_Recall": 0.983739837398374, "completeness": 0.6666666666666666, "hallucination": 0.0, "irrelevance": 0.3333333333333333, "responses": {"complete_ids": [1, 2], "irrelevant_ids": [3], "hallucinate_ids": []}}
{"domain": "Finance", "language": "zh", "query": {"query_id": 1, "query_type": "事实性问题", "content": "绿源环保有限公司在2017年4月发生了什么事故？"}, "ground_truth": {"doc_ids": [5], "content": "严重的废水泄漏事故。", "references": ["然而，在2017年4月，公司由于人为管理失误，发生了一起严重的废水泄漏事故，对周边环境和社区造成了污染。"], "keypoints": ["严重的废水泄漏事故。"]}, "prediction": {"content": "2017年6月，绿源环保有限公司发生了一起道德与诚信事件，对其声誉和信誉造成负面影响。", "references": ["绿源环保有限公司是一家成立于2005年6月的环保企业，主要从事绿色能源的研发、生产和销售业务，注册地位于北京市，目前尚未上市。", "2017年是绿源环保有限公司发展的关键一年。在财务信息方面，公司完成了一系列重要的资产重组和投资活动，为公司的未来发展奠定了坚实基础。", "在2017年7月，绿源环保有限公司进行了董事会变更。这一变更有助于提升公司的治理效能，并确保公司的决策能够更好地符合利益相关者的期望。", "然而，2017年6月，绿源环保有限公司发生了一起道德与诚信事件。这一事件对公司的声誉和信誉造成了一定的负面影响。公司将采取相应措施，加强道德和诚信教育，以避免类似事件再次发生。", "在公司治理结构方面，绿源环保有限公司一直致力于合规与监管更新。在2017年1月，公司积极关注环保法律法规的更新情况，并及时进行内部合规审查。此外，公司还不断更新合规措施，以确保公司在环保方面的合规性。在2017年5月，公司发布了环保情况报告，详细介绍了公司在环保方面的表现和成就。"]}, "ROUGELScore": 0.06666666346666682, "Words_Precision": 0.13043478260869565, "Words_Recall": 0.5555555555555556, "Sentences_Precision": 0.0, "Sentences_Recall": 0.0, "completeness": 1.0, "hallucination": 0.0, "irrelevance": 0.0, "responses": {"complete_ids": [1], "irrelevant_ids": [], "hallucinate_ids": []}}
{"domain": "Finance", "language": "zh", "query": {"query_id": 11, "query_type": "总结性问题", "content": "结合绿源环保有限公司2017年的环境与社会责任报告，总结其在2017年采取的环境责任措施。"}, "ground_truth": {"doc_ids": [5], "content": "根据绿源环保有限公司2017年的环境与社会责任报告，公司采取了多项环境责任措施。首先，公司在2017年2月投资于碳抵消项目，通过林业项目或可再生能源项目来抵消碳排放，努力实现碳中和目标；其次，公司在2017年3月建设了新的污染防治设施，如废水处理系统和排放控制设备，以减少环境污染；此外，公司在2017年5月实施了环境管理系统（EMS），提高环境绩效，减少废物产生，并确保合规；公司还在2017年6月实施了节能减排项目，减少能源消耗和温室气体排放；在2017年8月，公司开发了环保型产品，减少对环境的影响。这些措施显著提升了公司的环境绩效，履行了公司在环境保护方面的社会责任。", "references": ["首先，公司投资于碳抵消项目，通过投资林业项目或可再生能源项目来抵消其碳排放，努力实现碳中和目标。", "这一举措是在2017年2月实施的，通过碳抵消证书，公司能够向利益相关者展示其对环境的承诺和责任。", "最终，公司在2017年2月投资了碳抵消项目，通过投资林业项目或可再生能源项目来抵消其碳排放，进一步展示了公司对环境的承诺和责任。", "公司在2017年3月建立了新的污染防治设施，如废水处理系统和排放控制设备，以减少环境污染。", "这一举措显著降低了公司的环境污染水平，增强了合规性和社会责任感。", "在2017年5月，公司实施了环境管理系统（EMS），以提高环境绩效，减少废物产生，并确保合规。", "这一举措增强了公司的环境管理能力和持续改进，提升了合规性和市场认可度。", "此外，公司在2017年6月投资实施了节能减排项目，旨在减少能源消耗和温室气体排放。", "这一举措直接减少了公司的能源消耗和碳足迹，提高了能效和环境绩效。", "在2017年8月，公司还开发了环保型产品，减少对环境的影响，提升了产品的市场竞争力和品牌形象，同时减少了环境影响。"], "keypoints": ["1. 公司在2017年2月投资于碳抵消项目，努力实现碳中和目标。", "2. 公司在2017年3月建设了新的污染防治设施，减少环境污染。", "3. 公司在2017年5月实施了环境管理系统（EMS），提高环境绩效，减少废物产生，并确保合规。", "4. 公司在2017年6月实施了节能减排项目，减少能源消耗和温室气体排放。", "5. 在2017年8月，公司开发了环保型产品，减少对环境的影响。"]}, "prediction": {"content": "绿源环保有限公司2017年采取了多项环境责任措施，包括投资碳抵消项目、建立污染防治设施、实施环境管理系统和节能减排项目以及开发绿色产品。这些措施旨在提升公司的可持续性和社会责任表现，与利益相关者合作推动环保事业的发展。", "references": ["综上所述，绿源环保有限公司在2017年度在环境责任和社会责任方面采取了一系列重要举措。公司通过投资碳抵消项目、建立污染防治设施、实施环境管理系统、投资节能减排项目和开发绿色产品等方式，积极履行环境责任。同时，公司参与慈善活动、支持社区发展、参与公共服务项目、关注员工健康与安全和职业成长等方面，积极履行社会责任。公司的各项举措和指标数据表明，绿源环保有限公司在环境和社会责任方面取得了显著的进展，并为未来的可持续发展奠定了基础。", "在环境责任方面，绿源环保有限公司在2017年度采取了一系列重要的举措。首先，公司投资于碳抵消项目，通过投资林业项目或可再生能源项目来抵消其碳排放，努力实现碳中和目标。这一举措是在2017年2月实施的，通过碳抵消证书，公司能够向利益相关者展示其对环境的承诺和责任。此外，公司还制定了环境和社会责任政策，明确了在环境保护和社会责任方面的目标和承诺。在2017年1月至2月，公司对多个可再生能源项目进行了评估，包括太阳能、风能等，评估结果为公司选择投资碳抵消项目提供了依据，并为未来项目投资决策提供了参考。最终，公司在2017年2月投资了碳抵消项目，通过投资林业项目或可再生能源项目来抵消其碳排放，进一步展示了公司对环境的承诺和责任。", "为了提升可持续性和社会责任，绿源环保有限公司于2017年2月推出了一系列倡议。这些倡议旨在推动公司在可持续发展和社会责任方面的表现，并与相关利益相关者合作，共同推动环保事业的发展。", "另外，绿源环保有限公司在环境责任方面还采取了其他重要举措。公司在2017年3月建立了新的污染防治设施，如废水处理系统和排放控制设备，以减少环境污染。这一举措显著降低了公司的环境污染水平，增强了合规性和社会责任感。在2017年5月，公司实施了环境管理系统（EMS），以提高环境绩效，减少废物产生，并确保合规。这一举措增强了公司的环境管理能力和持续改进，提升了合规性和市场认可度。此外，公司在2017年6月投资实施了节能减排项目，旨在减少能源消耗和温室气体排放。这一举措直接减少了公司的能源消耗和碳足迹，提高了能效和环境绩效。在2017年8月，公司还开发了环保型产品，减少对环境的影响，提升了产品的市场竞争力和品牌形象，同时减少了环境影响。", "2017年是绿源环保有限公司发展的关键一年。在财务信息方面，公司完成了一系列重要的资产重组和投资活动，为公司的未来发展奠定了坚实基础。"]}, "ROUGELScore": 0.3228699513515253, "Words_Precision": 0.5792349726775956, "Words_Recall": 1.0, "Sentences_Precision": 0.4458788480635551, "Sentences_Recall": 0.980349344978166, "completeness": 0.4, "hallucination": 0.4, "irrelevance": 0.2, "responses": {"complete_ids": [1, 2], "irrelevant_ids": [3], "hallucinate_ids": []}}
{"domain": "Finance", "language": "zh", "query": {"query_id": 1385, "query_type": "多文档信息整合问题", "content": "美好家政服务有限公司和文化传媒有限公司在2018年和2019年分别有哪些高级管理层变动？"}, "ground_truth": {"doc_ids": [14, 7], "content": "美好家政服务有限公司在2018年3月新任CEO带来了新的管理理念和发展方向。文化传媒有限公司在2019年8月和2019年11月分别进行了高级管理层变动，包括CEO和CTO等关键职位的更换，影响了公司的运营重点、技术发展和创新能力。", "references": ["此外，公司在2018年3月进行了高级管理层变动，新任CEO带来了新的管理理念和发展方向。", "在高级管理层变动方面，文化传媒有限公司在2019年8月发生了高级管理层的变动，包括CEO或其他关键职位的更换。", "在高级管理层变动方面，文化传媒有限公司在2019年11月发生了高级管理层的变动，包括CTO或其他关键职位的更换。"], "keypoints": ["1. 美好家政服务有限公司在2018年3月新任CEO带来了新的管理理念和发展方向。", "2. 文化传媒有限公司在2019年8月进行了高级管理层变动，包括CEO等关键职位的更换。", "3. 文化传媒有限公司在2019年11月又进行了高级管理层变动，包括CTO等关键职位的更换。"]}, "prediction": {"content": "文化传媒有限公司2019年8月发生高级管理层变动。美好家政服务有限公司2018年7月开发环保型产品，提升市场竞争力和品牌形象。", "references": ["自2018年以来，美好家政服务有限公司经历了一系列重要事件，这些事件对公司的财务状况和业务发展产生了重大影响。", "美好家政服务有限公司是一家成立于2005年3月，注册地位于上海市徐汇区的家政服务公司，专业提供家庭清洁、保姆、育儿嫂、老人陪护等服务。", "在高级管理层变动方面，文化传媒有限公司在2019年8月发生了高级管理层的变动，包括CEO或其他关键职位的更换。这一变动可能导致公司运营重点和战略优先事项的调整，影响短期内的业绩和长期发展。", "此外，美好家政服务有限公司还开发了环保型产品，减少对环境的影响。在2018年7月，公司开发了一系列环保型产品，提高了产品的市场竞争力和品牌形象，同时减少了对环境的影响。", "在社会责任方面，美好家政服务有限公司也采取了一系列重要的措施。在2018年6月，公司推行了社会公正计划，包括平等就业机会、反腐败措施和社会因素评估等。通过建立公正和透明的企业文化，公司增加了在社会中的影响力和可持续发展性。"]}, "ROUGELScore": 0.2637362593937931, "Words_Precision": 0.25217391304347825, "Words_Recall": 0.7631578947368421, "Sentences_Precision": 0.13253012048192772, "Sentences_Recall": 0.3503184713375796, "completeness": 0.3333333333333333, "hallucination": 0.0, "irrelevance": 0.6666666666666666, "responses": {"complete_ids": [2], "irrelevant_ids": [1, 3], "hallucinate_ids": []}}
{"domain": "Finance", "language": "zh", "query": {"query_id": 1388, "query_type": "多文档时间序列问题", "content": "比较美好家政服务有限公司和文化传媒有限公司分别发生道德与诚信事件的时间，哪家公司事件发生时间更早？"}, "ground_truth": {"doc_ids": [14, 7], "content": "美好家政服务有限公司的道德与诚信事件发生时间更早，发生在2018年1月，而文化传媒有限公司的道德与诚信事件发生在2019年1月。", "references": ["首先，在2018年1月，公司曝光并处理了员工利益冲突和腐败事件。", "在公司治理结构方面，文化传媒有限公司在2019年1月发生了一起道德与诚信事件。"], "keypoints": ["1. 美好家政服务有限公司的道德与诚信事件发生时间更早。", "2. 美好家政服务有限公司的道德与诚信事件发生在2018年1月。", "3. 文化传媒有限公司的道德与诚信事件发生在2019年1月。"]}, "prediction": {"content": "美好家政服务有限公司于2018年6月推行社会公正计划，而文化传媒有限公司的道德与诚信事件时间未提及。\nUnable to answer.", "references": ["自2018年以来，美好家政服务有限公司经历了一系列重要事件，这些事件对公司的财务状况和业务发展产生了重大影响。", "美好家政服务有限公司是一家成立于2005年3月，注册地位于上海市徐汇区的家政服务公司，专业提供家庭清洁、保姆、育儿嫂、老人陪护等服务。", "此外，美好家政服务有限公司还开发了环保型产品，减少对环境的影响。在2018年7月，公司开发了一系列环保型产品，提高了产品的市场竞争力和品牌形象，同时减少了对环境的影响。", "在社会责任方面，美好家政服务有限公司也采取了一系列重要的措施。在2018年6月，公司推行了社会公正计划，包括平等就业机会、反腐败措施和社会因素评估等。通过建立公正和透明的企业文化，公司增加了在社会中的影响力和可持续发展性。"]}, "ROUGELScore": 0.5074626815950101, "Words_Precision": 0.13333333333333333, "Words_Recall": 0.41379310344827586, "Sentences_Precision": 0.0, "Sentences_Recall": 0.0, "completeness": 0.3333333333333333, "hallucination": 0.6666666666666666, "irrelevance": 0.0, "responses": {"complete_ids": [2], "irrelevant_ids": [], "hallucinate_ids": []}}
{"domain": "Finance", "language": "zh", "query": {"query_id": 1399, "query_type": "多文档对比问题", "content": "比较2017年华夏娱乐有限公司和2018年顶级购物中心的重大资产收购，哪家公司的资产收购金额更大？"}, "ground_truth": {"doc_ids": [0, 2], "content": "2017年华夏娱乐有限公司的资产收购金额更大，收购金额为1.2亿元，而2018年顶级购物中心的资产收购金额为5000万元。", "references": ["该资产收购涉及对华东百货股份有限公司的收购，总价值为5000万元。", "首先，在2017年2月，公司完成了对草莓文化传媒有限公司的资产收购，总价值1.2亿元。"], "keypoints": ["1. 2017年华夏娱乐有限公司的资产收购金额更大。", "2. 2017年华夏娱乐有限公司的资产收购金额为1.2亿元。", "3. 2018年顶级购物中心的资产收购金额为5000万元。"]}, "prediction": {"content": "2017年华夏娱乐有限公司完成对草莓文化传媒有限公司的资产收购，总价值1.2亿元。而顶级购物中心在这方面没有提及任何资产收购信息。因此，2017年华夏娱乐的资产收购金额更大。", "references": ["最后，在2017年12月，华夏娱乐完成了对嘉悦传媒有限公司的股权收购，获得了70%的股权。这次股权收购进一步扩大了华夏娱乐的市场份额，提升了公司的控制力。", "2017年度是华夏娱乐有限公司取得重要进展的一年。首先，在2017年2月，公司完成了对草莓文化传媒有限公司的资产收购，总价值1.2亿元。这次收购扩大了华夏娱乐的电视剧制作业务，增强了公司的市场竞争力。随后，在2017年3月，公司投资了一部以明星A为主角的电影《时光之恋》，投资金额为8000万元。这次投资进一步拓展了公司的电影制作业务，提升了公司的盈利能力。", "华夏娱乐有限公司成立于2001年5月，是一家多元化的娱乐公司，主要从事电影制作、音乐制作和艺人经纪业务，注册地为上海，并在2010年在上海证券交易所上市（股票代码：HXYE）。", "为了支持公司的扩张和发展，华夏娱乐在2017年7月进行了一次大规模的融资活动，募集了10亿元资金。这次融资活动加强了华夏娱乐的资金实力。为了改善公司的财务状况，华夏娱乐在2017年8月进行了债务重组，减少了5亿元负债。这次债务重组降低了公司的财务成本。", "在回报股东的同时，华夏娱乐决定在2017年10月向股东分发1亿元股利。这次股利发放提升了股东的收益。为了进一步优化公司的业务结构，华夏娱乐在2017年11月进行了一次资产重组，优化了公司的电影和音乐业务结构。这次资产重组提高了华夏娱乐的运营效率，增加了公司的价值。"]}, "ROUGELScore": 0.5277777729166667, "Words_Precision": 0.16911764705882354, "Words_Recall": 0.7931034482758621, "Sentences_Precision": 0.07095709570957096, "Sentences_Recall": 0.5584415584415584, "completeness": 0.6666666666666666, "hallucination": 0.0, "irrelevance": 0.3333333333333333, "responses": {"complete_ids": [1, 2], "irrelevant_ids": [3]}}
 
    </script>
    <script>
        let currentData = [];
        let baselineData = new Map(); // Store baseline data by query_id
        let baselineMetrics = new Map(); // Store baseline metrics by metric name

        document.addEventListener('DOMContentLoaded', function () {
            const initialDataElement = document.getElementById('initial-data');
            if (initialDataElement) {
                const content = initialDataElement.textContent.trim();
                if (content) {
                    const lines = content.split('\n');
                    const parsedData = lines.map(line => {
                        try {
                            const item = JSON.parse(line);
                            // Calculate F1 scores on load
                            if (item) {
                                const sentPrec = item.Sentences_Precision || 0;
                                const sentRec = item.Sentences_Recall || 0;
                                item.Sentences_F1 = (sentPrec + sentRec) > 0 ? (2 * sentPrec * sentRec) / (sentPrec + sentRec) : 0;

                                const wordPrec = item.Words_Precision || 0;
                                const wordRec = item.Words_Recall || 0;
                                item.Words_F1 = (wordPrec + wordRec) > 0 ? (2 * wordPrec * wordRec) / (wordPrec + wordRec) : 0;
                            }
                            return item;
                        } catch (e) {
                            return null;
                        }
                    }).filter(item => item !== null);

                    if (parsedData.length > 0) {
                        // Initialize baseline data
                        parsedData.forEach(item => {
                            if (item.query && item.query.query_id) {
                                baselineData.set(item.query.query_id, item);
                            }
                        });

                        // Set current data to initial data as well
                        currentData = parsedData;

                        // Default sort by query_id
                        currentData.sort((a, b) => {
                            let valA = a.query?.query_id ?? 0;
                            let valB = b.query?.query_id ?? 0;
                            return valA - valB;
                        });

                        document.getElementById('file-name').textContent = 'Baseline on 1204 submitted';
                        renderDashboard();
                    }
                }
            }
        });

        document.getElementById('file-upload').addEventListener('change', function (e) {
            const file = e.target.files[0];
            if (!file) return;

            const fileNameElement = document.getElementById('file-name');
            if (fileNameElement) {
                fileNameElement.textContent = file.name;
            } else {
                console.error('Element with id "file-name" not found');
            }

            const reader = new FileReader();
            reader.onload = function (e) {
                const content = e.target.result;
                const lines = content.trim().split('\n');
                currentData = lines.map(line => {
                    try {
                        const item = JSON.parse(line);
                        // Calculate F1 scores on load
                        if (item) {
                            const sentPrec = item.Sentences_Precision || 0;
                            const sentRec = item.Sentences_Recall || 0;
                            item.Sentences_F1 = (sentPrec + sentRec) > 0 ? (2 * sentPrec * sentRec) / (sentPrec + sentRec) : 0;

                            const wordPrec = item.Words_Precision || 0;
                            const wordRec = item.Words_Recall || 0;
                            item.Words_F1 = (wordPrec + wordRec) > 0 ? (2 * wordPrec * wordRec) / (wordPrec + wordRec) : 0;
                        }
                        return item;
                    } catch (e) {
                        return null;
                    }
                }).filter(item => item !== null);

                // Default sort by query_id
                currentData.sort((a, b) => {
                    let valA = a.query?.query_id ?? 0;
                    let valB = b.query?.query_id ?? 0;
                    return valA - valB;
                });

                renderDashboard();
                renderAvgBaseline();
            };
            reader.readAsText(file);
        });

        function renderAvgBaseline() {
            const metrics = {
                'ROUGELScore': 'avg-rouge',
                'Words_Precision': 'avg-words-precision',
                'Words_Recall': 'avg-words-recall',
                'Words_F1': 'avg-words-f1',
                'Sentences_Precision': 'avg-sentences-precision',
                'Sentences_Recall': 'avg-sentences-recall',
                'Sentences_F1': 'avg-sentences-f1',
                'completeness': 'avg-completeness',
                'hallucination': 'avg-hallucination',
                'irrelevance': 'avg-irrelevance'
            };
            Object.keys(metrics).forEach(metric => {
                const baselineElementId = metrics[metric] + '-bs';
                const baselineElement = document.getElementById(baselineElementId);
                if (baselineElement && baselineMetrics.has(metric)) {
                    baselineElement.textContent = baselineMetrics.get(metric);
                    baselineElement.style.opacity = '1';
                } else {
                    console.error(`Element with id "${baselineElementId}" not found`);
                }
            });
        }
        function renderDashboard() {
            document.getElementById('dashboard').style.display = 'block';
            calculateAverages();
            renderTable();
        }

        function calculateAverages() {
            const metrics = {
                'ROUGELScore': 'avg-rouge',
                'Words_Precision': 'avg-words-precision',
                'Words_Recall': 'avg-words-recall',
                'Words_F1': 'avg-words-f1',
                'Sentences_Precision': 'avg-sentences-precision',
                'Sentences_Recall': 'avg-sentences-recall',
                'Sentences_F1': 'avg-sentences-f1',
                'completeness': 'avg-completeness',
                'hallucination': 'avg-hallucination',
                'irrelevance': 'avg-irrelevance'
            };

            Object.keys(metrics).forEach(metric => {
                const sum = currentData.reduce((acc, item) => acc + (item[metric] || 0), 0);
                const avg = sum / currentData.length;
                const elementId = metrics[metric];
                const element = document.getElementById(elementId);
                if (element) {
                    element.textContent = avg.toFixed(3);
                }
                if (!baselineMetrics.has(metric)) {
                    baselineMetrics.set(metric, avg.toFixed(3));
                } else {
                    const avgElementId = metrics[metric] + '-bs';
                    const avgElement = document.getElementById(avgElementId);
                    let color = 'black';
                    if (avg < baselineMetrics.get(metric)) {
                        color = 'var(--danger-color)';
                    } else if (avg > baselineMetrics.get(metric)) {
                        color = 'var(--success-color)';
                    }
                    if (metric == 'hallucination' || metric == 'irrelevance') {
                        if (avg < baselineMetrics.get(metric)) {
                            color = 'var(--success-color)';
                        } else if (avg > baselineMetrics.get(metric)) {
                            color = 'var(--danger-color)';
                        }
                    }
                    if (avgElement) {
                        avgElement.style.color = color;
                    }
                }
            });
        }

        function getColorClass(value) {
            if (value >= 0.7) return 'score-high';
            if (value >= 0.4) return 'score-med';
            return 'score-low';
        }

        // Inverse color logic for negative metrics like hallucination/irrelevance
        function getInverseColorClass(value) {
            if (value <= 0.3) return 'score-high';
            if (value <= 0.6) return 'score-med';
            return 'score-low';
        }

        function getDiffHtml(currentVal, baselineVal) {
            if (baselineVal === undefined || baselineVal === null) return '';

            const diff = currentVal - baselineVal;
            if (Math.abs(diff) < 0.001) return '<span class="diff-neutral">(=)</span>';

            const sign = diff > 0 ? '+' : '';
            const className = diff > 0 ? 'diff-positive' : 'diff-negative';
            return `<span class="${className}">(${sign}${diff.toFixed(3)})</span>`;
        }

        function renderTable() {
            const tbody = document.getElementById('table-body');
            tbody.innerHTML = '';

            currentData.forEach((item, index) => {
                const row = document.createElement('tr');
                const queryId = item.query?.query_id ?? 'N/A';
                const queryText = item.query?.content ?? 'N/A';

                // Get baseline item
                const baselineItem = baselineData.get(queryId);

                row.innerHTML = `
                    <td><button class="expand-btn" onclick="toggleDetails(${index})">▶</button></td>
                    <td>${queryId}</td>
                    <td>${queryText.substring(0, 60)}${queryText.length > 60 ? '...' : ''}</td>
                    <td class="score-cell ${getColorClass(item.Sentences_Precision)}">
                        ${(item.Sentences_Precision || 0).toFixed(3)}
                        ${baselineItem ? getDiffHtml(item.Sentences_Precision, baselineItem.Sentences_Precision) : ''}
                    </td>
                    <td class="score-cell ${getColorClass(item.Sentences_Recall)}">
                        ${(item.Sentences_Recall || 0).toFixed(3)}
                        ${baselineItem ? getDiffHtml(item.Sentences_Recall, baselineItem.Sentences_Recall) : ''}
                    </td>
                    <td class="score-cell ${getColorClass(item.Sentences_F1)}">
                        ${(item.Sentences_F1 || 0).toFixed(3)}
                        ${baselineItem ? getDiffHtml(item.Sentences_F1, baselineItem.Sentences_F1) : ''}
                    </td>
                    <td class="score-cell ${getColorClass(item.Words_Precision)}">
                        ${(item.Words_Precision || 0).toFixed(3)}
                        ${baselineItem ? getDiffHtml(item.Words_Precision, baselineItem.Words_Precision) : ''}
                    </td>
                    <td class="score-cell ${getColorClass(item.Words_Recall)}">
                        ${(item.Words_Recall || 0).toFixed(3)}
                        ${baselineItem ? getDiffHtml(item.Words_Recall, baselineItem.Words_Recall) : ''}
                    </td>
                    <td class="score-cell ${getColorClass(item.Words_F1)}">
                        ${(item.Words_F1 || 0).toFixed(3)}
                        ${baselineItem ? getDiffHtml(item.Words_F1, baselineItem.Words_F1) : ''}
                    </td>
                    <td class="score-cell ${getColorClass(item.ROUGELScore)}">
                        ${(item.ROUGELScore || 0).toFixed(3)}
                        ${baselineItem ? getDiffHtml(item.ROUGELScore, baselineItem.ROUGELScore) : ''}
                    </td>
                    <td class="score-cell ${getColorClass(item.completeness)}">
                        ${(item.completeness || 0).toFixed(3)}
                        ${baselineItem ? getDiffHtml(item.completeness, baselineItem.completeness) : ''}
                    </td>
                    <td class="score-cell ${getInverseColorClass(item.hallucination)}">
                        ${(item.hallucination || 0).toFixed(3)}
                        ${baselineItem ? getDiffHtml(item.hallucination, baselineItem.hallucination) : ''}
                    </td>
                    <td class="score-cell ${getInverseColorClass(item.irrelevance)}">
                        ${(item.irrelevance || 0).toFixed(3)}
                        ${baselineItem ? getDiffHtml(item.irrelevance, baselineItem.irrelevance) : ''}
                    </td>
                `;
                tbody.appendChild(row);

                const detailsRow = document.createElement('tr');
                detailsRow.className = 'details-row';
                detailsRow.id = `details-${index}`;

                // Format References
                let referencesHtml = '';
                if (item.prediction?.references && item.prediction.references.length > 0) {
                    referencesHtml = '<ul class="references-list">' +
                        item.prediction.references.map(ref => `<li>${ref}</li>`).join('') +
                        '</ul>';
                } else {
                    referencesHtml = '<p class="detail-text">No references found.</p>';
                }

                let ground_truth_referencesHtml = '';
                if (item.ground_truth?.references && item.ground_truth.references.length > 0) {
                    ground_truth_referencesHtml = '<ul class="references-list">' +
                        item.ground_truth.references.map(ref => `<li>${ref}</li>`).join('') +
                        '</ul>';
                } else {
                    ground_truth_referencesHtml = '<p class="detail-text">No references found.</p>';
                }

                // Format Ground Truth Keypoints
                let keypointsHtml = '';
                if (item.ground_truth?.keypoints && item.ground_truth.keypoints.length > 0) {
                    keypointsHtml = '<ul class="references-list">' +
                        item.ground_truth.keypoints.map(kp => `<li>${kp}</li>`).join('') +
                        '</ul>';
                } else {
                    keypointsHtml = '<p class="detail-text">No keypoints found.</p>';
                }

                // Format Responses (Keypoint Analysis)
                let responsesHtml = '';
                if (item.responses) {
                    try {
                        const responsesObj = typeof item.responses === 'string' ? JSON.parse(item.responses) : item.responses;
                        responsesHtml = `
                            <div class="detail-text">
                                <div><strong>Complete IDs:</strong> ${responsesObj.complete_ids?.join(', ') || 'None'}</div>
                                <div><strong>Irrelevant IDs:</strong> ${responsesObj.irrelevant_ids?.join(', ') || 'None'}</div>
                                <div><strong>Hallucinate IDs:</strong> ${responsesObj.hallucinate_ids?.join(', ') || 'None'}</div>
                            </div>
                        `;
                    } catch (e) {
                        responsesHtml = `<div class="detail-text">${item.responses}</div>`;
                    }
                } else {
                    responsesHtml = '<p class="detail-text">No response analysis available.</p>';
                }


                detailsRow.innerHTML = `
                    <td colspan="12">
                        <div class="details-content">
                            <div class="detail-section">
                                <div class="detail-title">Full Query</div>
                                <div class="detail-text">${queryText}</div>
                            </div>
                            <div class="detail-section">
                                <div class="detail-title">Prediction Content</div>
                                <div class="detail-text">${item.prediction?.content || 'N/A'}</div>
                            </div>
                            <div class="detail-section">
                                <div class="detail-title">Ground Truth Content</div>
                                <div class="detail-text">${item.ground_truth?.content || 'N/A'}</div>
                            </div>
                            <div class="detail-section">
                                <div class="detail-title">Prediction References (${item.prediction.references.length})</div>
                                ${referencesHtml}
                            </div>
                            <div class="detail-section">
                                <div class="detail-title">Ground Truth References (${item.ground_truth.references.length})</div>
                                ${ground_truth_referencesHtml}
                            </div>
                             <div class="detail-section">
                                <div class="detail-title">Ground Truth Keypoints (${item.ground_truth.keypoints.length})</div>
                                ${keypointsHtml}
                            </div>
                             <div class="detail-section">
                                <div class="detail-title">Keypoint Analysis (Responses)</div>
                                ${responsesHtml}
                            </div>
                        </div>
                    </td>
                `;
                tbody.appendChild(detailsRow);
            });
        }

        function toggleDetails(index) {
            const row = document.getElementById(`details-${index}`);
            const btn = document.querySelector(`tr:nth-child(${index * 2 + 1}) .expand-btn`);
            if (row.style.display === 'table-row') {
                row.style.display = 'none';
                btn.textContent = '▶';
            } else {
                row.style.display = 'table-row';
                btn.textContent = '▼';
            }
        }

        let sortDirection = 1;
        function sortTable(key) {
            sortDirection *= -1;
            currentData.sort((a, b) => {
                let valA = key === 'query_id' ? (a.query?.query_id ?? 0) : (a[key] || 0);
                let valB = key === 'query_id' ? (b.query?.query_id ?? 0) : (b[key] || 0);

                if (valA < valB) return -1 * sortDirection;
                if (valA > valB) return 1 * sortDirection;
                return 0;
            });
            renderTable();
        }
    </script>
</body>

</html>